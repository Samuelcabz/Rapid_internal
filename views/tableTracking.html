{% extends 'base.html' %}

{% block content %}
<div class="container-fluid">
    <div class="card-body">
        <div class="text-center mb-4" style="margin-bottom: 1rem!important;">
            <h4 style="background-color: #264653; color: #fff; padding: 10px;">TRACKING PROGRESS TABLE</h4>
        </div>  
        <div class="card">
            <div class="card-body">                              
                <div class="table-responsive">
                    <div id="data_info" class="box">
                    <table id="dataTable" class="table table-striped">
                        <thead>
                            <tr>
                                <th>Id</th>
                                <th>Activity Title</th>
                                <th>Actual Date</th>
                                <th>Project Logframe Alignment</th>
                                <th>Number of AWPB Activity</th>
                                <th>Reflect Corresponding Indicator Number</th>
                                <th>Action</th>
                            </tr>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in rows %}
                            <tr>
                                <td>{{ row['Id']}}</td>
                                <td>{{ row['act_title'] }}</td>
                                <td>{{ row['Date'] }}</td>
                                <td>{{ row['logFrame'] }}</td>
                                <td>{{ row['AWPB'] }}</td>
                                <td>{{ row['reflect_i'] }}</td>
                                <td>
                                    <div style="display: flex; gap: 5px;">
                                        <a href="/Tracking_Form" class="btn-link btn-sm view-btn" style="cursor:pointer;">View</a>
                                        <a href="/Tracking_Form" class="btn-link btn-sm edit-btn" style="color: rgb(57, 189, 57); cursor:pointer;">Edit</a>
                                        <a class="btn-link btn-sm delete-btn" data-row-id="{{ row['Id'] }}" style="color: red; cursor: pointer;">Delete</a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                      </table>
                   </div>
               </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.querySelectorAll('.delete-btn').forEach(button => {
        button.addEventListener('click', function() {
            let rowId = this.dataset.rowId;
            deleteRow(rowId);
        });
    });

    function deleteRow(id) {
    fetch(`/delete/Tracking_Table/${id}`, {
        method: 'DELETE',
    })
    .then(response => {
        if (response.ok) {
            showToast("Row deleted successfully.", "#4ad66d", () => {
                location.reload();
            });
        } else {
            showToast("Failed to delete row.", "#f13030");
            console.error('Failed to delete row.');
        }
    })
    .catch(error => {
        showToast("Error occurred while deleting row.", "#f13030");
        console.error('Error:', error);
    });
}

function showToast(message, bgColor = "#4ad66d", callback) {
    Toastify({
        text: message,
        duration: 3000,
        close: true,
        gravity: "top",
        position: "center",
        style: {
            background: bgColor,
            borderRadius: "5px"
        },
        stopOnFocus: true,
        className: "Toastify__toast--bounceIn"
    }).showToast();

    if (callback) {
        setTimeout(callback, 1500); 
    }
}
</script>


<script>
    function eventFired(type) {
        let eventInfo = document.querySelector('#data_info');
        if (type !== 'Search' && type !== 'Page' && type !== 'Order') { 
            eventInfo.innerHTML += '<div>' + type + ' event - ' + new Date().getTime() + '</div>';
            eventInfo.scrollTop = eventInfo.scrollHeight;
        }
    }
    
    $(document).ready(function() {
        let dataTable = new DataTable('#dataTable', {
            searching: true
        });
        dataTable.on('order.dt', () => eventFired('Order'))
                 .on('search.dt', () => eventFired('Search'))
                 .on('page.dt', () => eventFired('Page'));
    });
</script>

<script src="../static/js/sidebarscript.js"></script>

{% endblock %}
